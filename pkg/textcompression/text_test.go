package textcompression

import (
	"context"
	"github.com/bitstored/compression-service/pb"
	"github.com/stretchr/testify/require"
	"testing"
)

func TestCompression(t *testing.T) {
	ts := []struct {
		Name         string
		Raw          []byte
		DefaultRatio float64
		BestRatio    float64
		NoRatio      float64
		FastRation   float64
		HuffmanRatio float64
	}{
		{
			Name: "SmallRepeatedData",
			Raw:  []byte("ana ana ana ana ana are mere si ana are pere si ana mananca per si ana are mere si ana mananca mere"),
		},
		{
			Name: "MediumRepeatedData",
			Raw:  []byte("World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao1. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao2. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao3. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao4. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao5. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao5. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao6. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao9. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao10. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao11. "),
		},
		{
			Name: "BigRepeatedData",
			Raw:  []byte("World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao.  Cel mai tare text ce se poate repeta.World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao.  Cel mai tare text ce se poate repeta.World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao.  Cel mai tare text ce se poate repeta.World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao.  Cel mai tare text ce se poate repeta.World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao. World's simplest string and text repeater. Just paste your text in the form below, press Repeat button, and you get repeated data. Press button, get repeated text. No ads, nonsense or garbage. Blanao.  Cel mai tare text ce se poate repeta."),
		},
		{
			Name: "SmallUniqueData",
			Raw:  []byte("qwerty uiop asd fgh jk lzxc vb nm98 45 23 56 4543 gtyhng sdjfjfggjf fjgghfjsak eiriirrhr sdwew swrf"),
		},
		{
			Name: "MediumUniqueData",
			Raw:  []byte("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim neque volutpat ac tincidunt vitae semper. Facilisis mauris sit amet massa vitae. Nulla malesuada pellentesque elit eget gravida cum. Ipsum a arcu cursus vitae congue. In massa tempor nec feugiat nisl pretium. Morbi tristique senectus et netus et malesuada fames. Amet est placerat in egestas erat. Sollicitudin nibh sit amet commodo. Vitae congue mauris rhoncus aenean. A condimentum vitae sapien pellentesque habitant morbi tristique senectus. Nisl vel pretium lectus quam id leo in vitae. Vulputate odio ut enim blandit volutpat maecenas volutpat blandit. Risus nullam eget felis eget nunc. Eget nunc scelerisque viverra mauris in aliquam sem fringilla. Vehicula ipsum a arcu cursus vitae congue mauris rhoncus aenean. Risus quis varius quam quisque id. Mollis nunc sed id semper risus. Cras adipiscing enim eu turpis egestas pretium aenean pharetra. Sit amet massa vitae tortor condimentum lacinia.Nibh cras pulvinar mattis nunc sed blandit libero volutpat sed. Habitant morbi tristique senectus et netus. Vulputate eu scelerisque felis imperdiet proin fermentum. Vitae auctor eu augue ut lectus. Massa enim nec dui nunc mattis enim ut tellus. Vulputate eu scelerisque felis imperdiet proin fermentum leo. Vitae sapien pellentesque habitant morbi tristique senectus et netus. Et netus et malesuada fames ac turpis. Rhoncus est pellentesque elit ullamcorper dignissim cras tincidunt lobortis. Eu facilisis sed odio morbi quis commodo odio aenean sed. Sit amet consectetur adipiscing elit. Quis viverra nibh cras pulvinar mattis nunc sed blandit. Tellus orci ac auctor augue mauris augue neque gravida in. Aliquet nec ullamcorper sit amet."),
		},
		{
			Name: "BigUniqueData",
			Raw:  []byte("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim neque volutpat ac tincidunt vitae semper. Facilisis mauris sit amet massa vitae. Nulla malesuada pellentesque elit eget gravida cum. Ipsum a arcu cursus vitae congue. In massa tempor nec feugiat nisl pretium. Morbi tristique senectus et netus et malesuada fames. Amet est placerat in egestas erat. Sollicitudin nibh sit amet commodo. Vitae congue mauris rhoncus aenean. A condimentum vitae sapien pellentesque habitant morbi tristique senectus. Nisl vel pretium lectus quam id leo in vitae. Vulputate odio ut enim blandit volutpat maecenas volutpat blandit. Risus nullam eget felis eget nunc. Eget nunc scelerisque viverra mauris in aliquam sem fringilla. Vehicula ipsum a arcu cursus vitae congue mauris rhoncus aenean. Risus quis varius quam quisque id. Mollis nunc sed id semper risus. Cras adipiscing enim eu turpis egestas pretium aenean pharetra. Sit amet massa vitae tortor condimentum lacinia. \n Nibh cras pulvinar mattis nunc sed blandit libero volutpat sed. Habitant morbi tristique senectus et netus. Vulputate eu scelerisque felis imperdiet proin fermentum. Vitae auctor eu augue ut lectus. Massa enim nec dui nunc mattis enim ut tellus. Vulputate eu scelerisque felis imperdiet proin fermentum leo. Vitae sapien pellentesque habitant morbi tristique senectus et netus. Et netus et malesuada fames ac turpis. Rhoncus est pellentesque elit ullamcorper dignissim cras tincidunt lobortis. Eu facilisis sed odio morbi quis commodo odio aenean sed. Sit amet consectetur adipiscing elit. Quis viverra nibh cras pulvinar mattis nunc sed blandit. Tellus orci ac auctor augue mauris augue neque gravida in. Aliquet nec ullamcorper sit amet.\nNunc pulvinar sapien et ligula ullamcorper malesuada proin libero nunc. Nisi est sit amet facilisis. Felis bibendum ut tristique et egestas quis ipsum. A arcu cursus vitae congue mauris rhoncus aenean vel. Tempor orci dapibus ultrices in. Quam adipiscing vitae proin sagittis nisl rhoncus mattis rhoncus. Tortor pretium viverra suspendisse potenti nullam ac tortor. Pulvinar mattis nunc sed blandit libero. Laoreet sit amet cursus sit amet dictum sit. Quam nulla porttitor massa id neque aliquam. Risus in hendrerit gravida rutrum quisque non tellus. Aliquam faucibus purus in massa tempor nec feugiat nisl pretium. Sagittis aliquam malesuada bibendum arcu. Lacus viverra vitae congue eu. Id semper risus in hendrerit gravida rutrum. Purus in massa tempor nec feugiat nisl. Elit eget gravida cum sociis natoque penatibus. Ac ut consequat semper viverra nam.\nRisus commodo viverra maecenas accumsan. Aliquet risus feugiat in ante. Eu ultrices vitae auctor eu augue ut lectus arcu bibendum. Enim facilisis gravida neque convallis a cras semper auctor neque. Ut faucibus pulvinar elementum integer enim neque volutpat ac. Purus in mollis nunc sed id. Vitae justo eget magna fermentum iaculis eu. Phasellus vestibulum lorem sed risus ultricies. Tempor orci dapibus ultrices in iaculis nunc sed augue. Venenatis lectus magna fringilla urna porttitor rhoncus dolor purus non. Tristique senectus et netus et malesuada fames ac turpis egestas. Faucibus in ornare quam viverra orci sagittis eu. Massa id neque aliquam vestibulum morbi blandit cursus risus at. Semper feugiat nibh sed pulvinar proin gravida hendrerit lectus a. Tellus cras adipiscing enim eu turpis. Nunc mattis enim ut tellus elementum sagittis. Risus in hendrerit gravida rutrum quisque non. Hendrerit dolor magna eget est.\nScelerisque eleifend donec pretium vulputate sapien nec. Odio ut enim blandit volutpat maecenas volutpat blandit. Velit euismod in pellentesque massa placerat duis. Diam in arcu cursus euismod quis viverra. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Faucibus interdum posuere lorem ipsum dolor sit. Et pharetra pharetra massa massa ultricies mi quis. Ut eu sem integer vitae justo eget magna fermentum iaculis. Vitae suscipit tellus mauris a diam maecenas sed. Adipiscing at in tellus integer. Quis ipsum suspendisse ultrices gravida dictum fusce ut. Quis hendrerit dolor magna eget est lorem. Auctor elit sed vulputate mi. Id donec ultrices tincidunt arcu non sodales neque sodales ut. Aliquet lectus proin nibh nisl condimentum id. Suscipit tellus mauris a diam maecenas sed enim ut sem. Non tellus orci ac auctor augue mauris. Neque convallis a cras semper auctor neque. Sit amet risus nullam eget felis eget nunc lobortis mattis.\nNulla facilisi nullam vehicula ipsum. Pellentesque elit eget gravida cum sociis natoque penatibus et magnis. Nisi porta lorem mollis aliquam ut porttitor leo. Velit dignissim sodales ut eu sem. Mauris ultrices eros in cursus turpis massa tincidunt dui ut. Bibendum at varius vel pharetra vel turpis nunc. Et magnis dis parturient montes nascetur ridiculus. Ultrices neque ornare aenean euismod elementum nisi quis. Et sollicitudin ac orci phasellus egestas tellus rutrum. Facilisis volutpat est velit egestas dui id ornare arcu. Purus ut faucibus pulvinar elementum. Mi in nulla posuere sollicitudin aliquam ultrices sagittis. Quisque id diam vel quam elementum pulvinar etiam. Neque aliquam vestibulum morbi blandit. Tincidunt vitae semper quis lectus nulla at."),
		},
	}

	for _, tc := range ts {
		t.Run(tc.Name, func(t *testing.T) {
			s := NewZlibCompressor()
			dbytes, err := s.Compress(context.TODO(), tc.Raw, pb.CompressionLevel_DefaultCompression)
			require.NoError(t, err.Error())

			bbytes, err := s.Compress(context.TODO(), tc.Raw, pb.CompressionLevel_BestCompression)
			require.NoError(t, err.Error())

			nbytes, err := s.Compress(context.TODO(), tc.Raw, pb.CompressionLevel_NoCompression)
			require.NoError(t, err.Error())

			hbytes, err := s.Compress(context.TODO(), tc.Raw, pb.CompressionLevel_HuffmanOnly)
			require.NoError(t, err.Error())

			fbytes, err := s.Compress(context.TODO(), tc.Raw, pb.CompressionLevel_BestSpeed)
			require.NoError(t, err.Error())

			dtext, err := s.Decompress(context.TODO(), dbytes)
			require.NoError(t, err.Error())
			require.Equal(t, tc.Raw, dtext)
			tc.DefaultRatio = float64(len(dbytes)) / float64(len(tc.Raw))

			btext, err := s.Decompress(context.TODO(), bbytes)
			require.NoError(t, err.Error())
			require.Equal(t, tc.Raw, btext)
			tc.BestRatio = float64(len(bbytes)) / float64(len(tc.Raw))

			ntext, err := s.Decompress(context.TODO(), nbytes)
			require.NoError(t, err.Error())
			require.Equal(t, tc.Raw, ntext)
			tc.NoRatio = float64(len(nbytes)) / float64(len(tc.Raw))

			htext, err := s.Decompress(context.TODO(), hbytes)
			require.NoError(t, err.Error())
			require.Equal(t, tc.Raw, htext)
			tc.HuffmanRatio = float64(len(hbytes)) / float64(len(tc.Raw))

			ftext, err := s.Decompress(context.TODO(), fbytes)
			require.NoError(t, err.Error())
			require.Equal(t, tc.Raw, ftext)
			tc.FastRation = float64(len(fbytes)) / float64(len(tc.Raw))
		})
	}

}
